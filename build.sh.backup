#!/bin/bash
set -e

echo "Building FastBloomFilter..."
echo ""

# Clean
echo "Cleaning..."
rm -f *.gem
rm -rf lib/fast_bloom_filter/*.{so,bundle}
cd ext/fast_bloom_filter && make clean 2>/dev/null || true && cd ../..

# Compile
echo "Compiling C extension..."
cd ext/fast_bloom_filter
ruby extconf.rb
make
cd ../..

# Copy
echo "Copying library..."
mkdir -p lib/fast_bloom_filter
cp ext/fast_bloom_filter/fast_bloom_filter.so lib/fast_bloom_filter/

# Test
echo "Running tests..."
ruby -I lib -I test test/fast_bloom_filter_test.rb

# Build gem
echo "Building gem..."
gem build fast_bloom_filter.gemspec

echo ""
echo "Done! Gem: fast_bloom_filter-1.0.0.gem"
